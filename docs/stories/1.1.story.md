
---
story:
  epic: 1
  story: 1
  title: "Calculate Basic Loan Payment"
  status: "Approved"
---

As a user, I want to enter the loan amount, interest rate, and loan term, so that I can see my estimated monthly payment, total interest paid, and total repayment.

### Acceptance Criteria
- The screen displays input fields for "Loan Amount", "Annual Interest Rate (%)", and "Loan Term (Years)".
- Input fields accept numerical values (decimals for amount/rate, integers for term).
- As values are entered/changed, the "Monthly Payment", "Total Interest Paid", and "Total Repayment" fields are automatically updated with calculated results.
- All financial output values (monthly payment, total interest, total repayment) are displayed formatted as currency (e.g., "$1,234.56 CAD") and are rounded to two decimal places.
- Input validation:
    - Loan Amount must be greater than 0.
    - Annual Interest Rate must be greater than or equal to 0.
    - Loan Term (Years) must be greater than 0.
    - If inputs are invalid, calculation results should default to "$0.00" or show an appropriate error message, without crashing.

### Dev Notes

#### Data Models
- **LoanCalculation Entity:** Defines the core business object for a loan calculation.
- **LoanCalculationModel:** Handles conversion between the entity and the `sqflite` map representation.
- All money-related values are stored as integers representing cents.
[Source: architecture/3-data-models-entities.md]

#### API Specifications
- No external APIs are required for this story.

#### Component Specifications
- **Loan Input Form:** A widget containing input fields for Loan Amount, Annual Interest Rate, and Loan Term.
- **Loan Result Display:** A widget to display the calculated Monthly Payment, Total Interest Paid, and Total Repayment.
[Source: architecture/1-architectural-overview-clean-architecture-layered-approach.md]

#### File Locations
- **Feature Directory:** `lib/features/loan_calculator/`
- **Data Layer:**
    - `data/repositories/loan_calculation_repository_impl.dart`
- **Domain Layer:**
    - `domain/entities/loan_calculation.dart`
    - `domain/repositories/i_loan_calculation_repository.dart`
    - `domain/usecases/calculate_loan_payment_usecase.dart`
- **Presentation Layer:**
    - `presentation/pages/loan_calculator_page.dart`
    - `presentation/widgets/loan_input_form.dart`
    - `presentation/widgets/loan_result_display.dart`
- **Providers:** `providers/loan_calculation_providers.dart`
[Source: architecture/1-architectural-overview-clean-architecture-layered-approach.md]

#### Testing Requirements
- **Unit Tests:**
    - Test the `CalculateLoanPaymentUseCase` with various inputs and edge cases.
    - Test the `LoanCalculationModel` conversions.
- **Widget Tests:**
    - Test the `LoanInputForm` and `LoanResultDisplay` widgets.
    - Verify input validation and formatting.
- **Integration Tests:**
    - Test the full feature flow from input to display.
[Source: architecture/6-qa-strategy.md]

#### Technical Constraints
- All financial calculations must handle money as integers representing cents to avoid floating-point inaccuracies. [Source: architecture/3-data-models-entities.md]

### Tasks / Subtasks

1.  **Create the feature directory structure for `loan_calculator`.** (AC: 1)
    - Reference: `architecture/1-architectural-overview-clean-architecture-layered-approach.md`
2.  **Implement the `LoanCalculation` entity and `LoanCalculationModel`.** (AC: 1, 2, 3, 4)
    - Reference: `architecture/3-data-models-entities.md`
3.  **Implement the `CalculateLoanPaymentUseCase`.** (AC: 3)
    - Reference: `architecture/5-use-cases.md`
4.  **Create the `LoanInputForm` widget.** (AC: 1, 2, 5)
    - Reference: `architecture/1-architectural-overview-clean-architecture-layered-approach.md`
5.  **Create the `LoanResultDisplay` widget.** (AC: 3, 4)
    - Reference: `architecture/1-architectural-overview-clean-architecture-layered-approach.md`
6.  **Develop the `LoanCalculatorPage` to integrate the form and result display.** (AC: 1, 2, 3, 4, 5)
7.  **Write unit tests for the `CalculateLoanPaymentUseCase` and `LoanCalculationModel`.** (AC: 3, 4, 5)
    - Reference: `architecture/6-qa-strategy.md`
8.  **Write widget tests for the `LoanInputForm` and `LoanResultDisplay` widgets.** (AC: 1, 2, 3, 4, 5)
    - Reference: `architecture/6-qa-strategy.md`
9.  **Write integration tests for the loan calculation feature.** (AC: 1, 2, 3, 4, 5)
    - Reference: `architecture/6-qa-strategy.md`
