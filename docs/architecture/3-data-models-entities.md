# 3\. Data Models & Entities

**Crucial Decision:** All money-related values (`loanAmount`, `monthlyPayment`, `initialInvestment`, `regularContribution`, `estimatedFutureValue`, `totalInterestPaid`, `totalRepayment`, `totalContributions`, `totalEarnings`) will be stored and processed as **`int` (integers representing cents)**. This design choice mitigates floating-point inaccuracies commonly associated with `double` when handling financial calculations. The Presentation Layer (UI) will be responsible for converting user-friendly `double` inputs (e.g., "$100.50") into `int` (e.g., `10050`) for internal processing and storage, and for formatting `int` outputs back to `double` strings (e.g., "$100.50") for display.

## 3.1. Loan Calculation

  * **`lib/features/loan_calculator/domain/entities/loan_calculation.dart`**
    (Domain Entity - defines the core business object, independent of storage details)
    ```dart
    import 'package:freezed_annotation/freezed_annotation.dart';

    part 'loan_calculation.freezed.dart'; // Generated by freezed
    part 'loan_calculation.g.dart';     // Generated by json_serializable (if used for to/from json)

    @freezed
    class LoanCalculation with _$LoanCalculation {
      const factory LoanCalculation({
        int? id,                            // Null for unsaved calculations
        required int loanAmountCents,          // Stored as integer cents (e.g., $100.50 -> 10050)
        required double interestRate,          // Annual interest rate as percentage (e.g., 3.5 for 3.5%)
        required int loanTermYears,            // Loan term in full years
        required int monthlyPaymentCents,      // Calculated monthly payment in cents
        required int totalInterestPaidCents,   // Total interest paid over loan term in cents
        required int totalRepaymentCents,      // Total repayment (principal + interest) in cents
        required DateTime savedAt,             // Timestamp for when the calculation was saved
      }) = _LoanCalculation;

      factory LoanCalculation.fromJson(Map<String, dynamic> json) => _$LoanCalculationFromJson(json);
    }
    ```
  * **`lib/features/loan_calculator/data/models/loan_calculation_model.dart`**
    (Data Model - handles conversion between Entity and `sqflite` Map representation)
    ```dart
    import 'package:personal_finance_calculator/features/loan_calculator/domain/entities/loan_calculation.dart';

    class LoanCalculationModel {
      final int? id;
      final int loanAmountCents;
      final double interestRate;
      final int loanTermYears;
      final int monthlyPaymentCents;
      final int totalInterestPaidCents;
      final int totalRepaymentCents;
      final DateTime savedAt;

      LoanCalculationModel({
        this.id,
        required this.loanAmountCents,
        required this.interestRate,
        required this.loanTermYears,
        required this.monthlyPaymentCents,
        required this.totalInterestPaidCents,
        required this.totalRepaymentCents,
        required this.savedAt,
      });

      // Converts the model to a Map suitable for sqflite insertion/update
      Map<String, dynamic> toMap() {
        return {
          'id': id,
          'loanAmount': loanAmountCents,
          'interestRate': interestRate,
          'loanTermYears': loanTermYears,
          'monthlyPayment': monthlyPaymentCents,
          'totalInterestPaid': totalInterestPaidCents,
          'totalRepayment': totalRepaymentCents,
          'savedAt': savedAt.toIso8601String(), // Store DateTime as ISO 8601 String
        };
      }

      // Creates a model from a Map retrieved from sqflite
      factory LoanCalculationModel.fromMap(Map<String, dynamic> map) {
        return LoanCalculationModel(
          id: map['id'] as int?,
          loanAmountCents: map['loanAmount'] as int,
          interestRate: map['interestRate'] as double,
          loanTermYears: map['loanTermYears'] as int,
          monthlyPaymentCents: map['monthlyPayment'] as int,
          totalInterestPaidCents: map['totalInterestPaid'] as int,
          totalRepaymentCents: map['totalRepayment'] as int,
          savedAt: DateTime.parse(map['savedAt'] as String), // Parse back to DateTime
        );
      }

      // Converts a domain entity to a data model for persistence
      factory LoanCalculationModel.fromEntity(LoanCalculation entity) {
        return LoanCalculationModel(
          id: entity.id,
          loanAmountCents: entity.loanAmountCents,
          interestRate: entity.interestRate,
          loanTermYears: entity.loanTermYears,
          monthlyPaymentCents: entity.monthlyPaymentCents,
          totalInterestPaidCents: entity.totalInterestPaidCents,
          totalRepaymentCents: entity.totalRepaymentCents,
          savedAt: entity.savedAt,
        );
      }

      // Converts the data model back to a domain entity for use in the domain/presentation layers
      LoanCalculation toEntity() {
        return LoanCalculation(
          id: id,
          loanAmountCents: loanAmountCents,
          interestRate: interestRate,
          loanTermYears: loanTermYears,
          monthlyPaymentCents: monthlyPaymentCents,
          totalInterestPaidCents: totalInterestPaidCents,
          totalRepaymentCents: totalRepaymentCents,
          savedAt: savedAt,
        );
      }
    }
    ```

## 3.2. Investment Calculation

  * **`lib/features/investment_calculator/domain/entities/investment_calculation.dart`**
    ```dart
    import 'package:freezed_annotation/freezed_annotation.dart';

    part 'investment_calculation.freezed.dart';
    part 'investment_calculation.g.dart';

    @freezed
    class InvestmentCalculation with _$InvestmentCalculation {
      const factory InvestmentCalculation({
        int? id,
        required int initialInvestmentCents,    // Initial lump sum in cents
        required int regularContributionCents,  // Regular contribution amount in cents
        required String contributionFrequency,  // e.g., 'Monthly', 'Quarterly', 'Annually'
        required double interestRate,          // Annual interest rate as percentage
        required int investmentPeriodYears,    // Investment duration in full years
        required int estimatedFutureValueCents,// Projected future value in cents
        required int totalContributionsCents,  // Sum of initial + all regular contributions in cents
        required int totalEarningsCents,       // Estimated earnings (future value - total contributions) in cents
        required DateTime savedAt,             // Timestamp for when the calculation was saved
      }) = _InvestmentCalculation;

      factory InvestmentCalculation.fromJson(Map<String, dynamic> json) => _$InvestmentCalculationFromJson(json);
    }
    ```
  * **`lib/features/investment_calculator/data/models/investment_calculation_model.dart`**
    (Similar structure to `LoanCalculationModel` for `toMap()`, `fromMap()`, `fromEntity()`, `toEntity()`, handling `int` cents and `DateTime` string conversions.)

## 3.3. Bank Rate

  * **`lib/features/bank_rates/domain/entities/bank_rate.dart`**
    ```dart
    import 'package:freezed_annotation/freezed_annotation.dart';

    part 'bank_rate.freezed.dart';
    part 'bank_rate.g.dart';

    @freezed
    class BankRate with _$BankRate {
      const factory BankRate({
        required String bankName,
        required String productName,
        required double interestRate, // Percentage, typically remains double
        required String rateType,     // e.g., 'Mortgage', 'GIC', 'Savings'
        required int termMonths,      // e.g., 60 for 5-Year Mortgage, 12 for 1-Year GIC
        required DateTime lastUpdated, // Timestamp for when this rate was last updated/published by bank
        String? additionalInfo,       // Optional extra details
      }) = _BankRate;

      factory BankRate.fromJson(Map<String, dynamic> json) => _$BankRateFromJson(json);
    }
    ```
  * **`lib/features/bank_rates/data/models/bank_rate_model.dart`**
    (Data Model - for mapping directly from API JSON responses)
    ```dart
    import 'package:json_annotation/json_annotation.dart';
    import 'package:personal_finance_calculator/features/bank_rates/domain/entities/bank_rate.dart';

    part 'bank_rate_model.g.dart'; // Generated by json_serializable

    @JsonSerializable()
    class BankRateModel {
      final String bankName;
      final String productName;
      final double interestRate;
      final String rateType;
      final int termMonths;
      final String lastUpdated; // As string from API, parsed to DateTime in toEntity()
      final String? additionalInfo;

      BankRateModel({
        required this.bankName,
        required this.productName,
        required this.interestRate,
        required this.rateType,
        required this.termMonths,
        required this.lastUpdated,
        this.additionalInfo,
      });

      factory BankRateModel.fromJson(Map<String, dynamic> json) => _$BankRateModelFromJson(json);
      Map<String, dynamic> toJson() => _$BankRateModelToJson(this);

      // Converts the data model to a domain entity
      BankRate toEntity() {
        return BankRate(
          bankName: bankName,
          productName: productName,
          interestRate: interestRate,
          rateType: rateType,
          termMonths: termMonths,
          lastUpdated: DateTime.parse(lastUpdated), // Parse ISO 8601 string to DateTime
          additionalInfo: additionalInfo,
        );
      }
    }
    ```

-----
